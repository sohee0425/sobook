<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<th:block layout:fragment="css">
  <style>
    /* 별평점 기본효과 스타일 */
    p#star_rev_score a.rev_score {
      font-size: 22px;
      text-decoration: none;
      color: lightgray;
    }

    /* 별평점에 클릭했을 경우 선택자 */
    p#star_rev_score a.rev_score.on {
      color: goldenrod;
    }
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css");


    #tabs ul li {
    background-color: #f8f9fa;
    border: 1px solid #ccc;
    display: inline-block;
    cursor: pointer;
}

/* 활성화된 탭 스타일 */
#tabs ul li.ui-tabs-active {
    background-color: black; 
    color: white;
    font-weight: bold;
}
  </style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
</th:block>

<th:block layout:fragment="script">


<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
  <script>
    $( function() {
      $( "#tabs" ).tabs();
    } );
    </script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script id="templateReview" type="text/x-handlebars-template">
      <table class="table" id="reviewTable">
        <tbody>
          {{#each .}}
          <tr>
            <td>{{rev_code}}</td>
            <td>{{mem_id}}</td>
            <td>{{rev_content}}</td>
            <td>{{displayStar rev_score}}</td>
            <td>{{convertDate rev_date}}</td>
            <td>
              {{authControlView mem_id rev_code}}
            </td>
          </tr>
          {{#if replies.length}}
          {{#each replies}}
          <tr>
            <td colspan="6">[관리자] 답변글 : {{reply_content}} 작성일 : {{convertDate reply_date}}</td>
          </tr>
            {{/each}}
            {{/if}}
            {{/each}}
        </tbody>
      </table>
    </script>

    <script id="templateQna" type="text/x-handlebars-template">
      <table class="table" id="qnaTable">
        <tbody>
          {{#each .}}
          <tr>
            <td>{{qna_code}}</td>
            <td>{{mem_id}}</td>
            <td>{{qna_title}}</td>
            <td>{{qna_content}}</td>
            <td>{{convertDate qna_date}}</td>
            <td>
              {{authControlView mem_id qna_code}}
            </td>
          </tr>
          {{#if answer.length}}
          {{#each answer}}
          <tr>
            <td colspan="6">[관리자] 답변글 : {{ans_content}} 작성일 : {{convertDate ans_date}}</td></td>
          </tr>
            {{/each}}
            {{/if}}
            {{/each}}
        </tbody>
      </table>
    </script>

    <script th:inline="javascript">
      // 핸들바 템플릿에서 사용자정의 함수 : 후기작성시간 포맷(형식)
      Handlebars.registerHelper("convertDate", function(reviewDate) {
        const date = new Date(reviewDate);
  
        let month = (date.getMonth()+1 < 10 ? "0" + (date.getMonth()+1) : date.getMonth()+1);
        let day = (date.getDate() < 10 ? "0" + (date.getDate()) : date.getDate());
        let hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
        let minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
        let second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
        return date.getFullYear() + "/" + month + "/" + day + " " + hour + ":" + minute + ":" + second;
      });

      // 핸들바 템플릿 사용자 정의 함수- 로그인 사용자와 후기 작성자가 같을 때만 수정,삭제 버튼 표시하기
      Handlebars.registerHelper("authControlView", function(mem_id, rev_code) {
        console.log("작성자", mem_id);
        console.log("후기번호", rev_code)
        // 로그인 사용자는 세션으로 확인한다.
        let memberVo = [[${session.login_auth}]];

        let loginId = "";

        if(memberVo !== null) { // 로그인
          loginId = [[${session.login_auth == null? '' : session.login_auth.mem_id}]];
        }

        console.log("아이디", loginId);

        let str = "";

        // 로그인상태이며 로그인=후기아이디 일치 시
        if(memberVo !== null && loginId == mem_id) {
          str += `<button type="button" name="delete" class="btn btn-outline-danger btn-sm ml-3" data-rev_code="${rev_code}">delete</button>`;
          str += `<button type="button" name="edit" class="btn btn-outline-info btn-sm" data-rev_code="${rev_code}">edit</button>`;

          return new Handlebars.SafeString(str);
        }else {
          return str;
        }
      });

      // 평점 별표시 핸들바 사용자정의 함수
      Handlebars.registerHelper("displayStar", function(rating) {
        let star = "";
        switch(rating) {
          case 1:
            star = "★☆☆☆☆";
            break;
          case 2:
            star = "★★☆☆☆";
            break;
          case 3:
            star = "★★★☆☆";
            break;
          case 4:
            star = "★★★★☆";
            break;
          case 5:
            star = "★★★★★";
            break;
        }
        return star;
      });
 </script>   

<script th:inline="javascript">
  // 핸들바 템플릿에서 사용자정의 함수 : 후기작성시간 포맷(형식)
  Handlebars.registerHelper("convertDate", function(qnaDate) {
    const date = new Date(qnaDate);

    let month = (date.getMonth()+1 < 10 ? "0" + (date.getMonth()+1) : date.getMonth()+1);
    let day = (date.getDate() < 10 ? "0" + (date.getDate()) : date.getDate());
    let hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
    let minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
    let second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
    return date.getFullYear() + "/" + month + "/" + day + " " + hour + ":" + minute + ":" + second;
  });

  Handlebars.registerHelper("authControlView", function(mem_id, qna_code) {
    console.log("작성자", mem_id);
    console.log("문의번호", qna_code)
    let memberVo = [[${session.login_auth}]];

    let loginId = "";

    if(memberVo !== null) { 
      loginId = [[${session.login_auth == null? '' : session.login_auth.mem_id}]];
    }

    console.log("아이디", loginId);

    let str = "";

    if(memberVo !== null && loginId == mem_id) {
      // str += `<button type="button" id="btnQnaModify" class="btn btn-outline-success btn-sm ml-3" data-qna_code="${qna_code}">수정</button>`;
      // str += `<button type="button" id="btnQnaDelete" class="btn btn-outline-info btn-sm" data-qna_code="${qna_code}">삭제</button>`;
      str += `<button type="button" class="btn btn-outline-success btn-sm ml-3 btn-qna-modify" data-qna_code="${qna_code}">수정</button>`;
      str += `<button type="button" class="btn btn-outline-info btn-sm btn-qna-delete" data-qna_code="${qna_code}">삭제</button>`;
      return new Handlebars.SafeString(str);
    }else {
      return str;
    }
  });
</script> 
</th:block>

<th:block layout:fragment="content">


  <div class="row">
    <div class="col-12 col-sm-6">
      <h3 th:utext="${cate_name}"></h3>
      <div class="col-12">
        <img style="width: 80%;height: 350px;" th:src="${'/product/image_display?dateFolderName=' + productVo.pro_up_folder + '&fileName=' + productVo.pro_img}">
      </div>
    </div>
    <div class="col-12 col-sm-6">
      <h3 class="mt-3" th:text="${productVo.pro_name}">제품명</h3>
      <small class="text-body-secondary">상품후기 : <span id="review_count" th:text="${productVo.pro_review}"></span></small>
      <hr>

      <div class="bg-gray py-2 px-3 mt-4">
      <h5 class="mb-0">
        <div class="mt-3">가격 | <span>[[${#numbers.formatInteger(productVo.pro_price, 3, 'COMMA') + '원'}]]</span></div>
      </h5>
      <h5 class="mb-0">
        <div class="mt-3">할인율 | <span th:text="${productVo.pro_discount}"></span></div>
      <h5 class="mb-0">
        <div class="mt-3">출판사 | <span th:text="${productVo.pro_publisher}"></span></div>
      </h5>
      <h5 class="mb-0">
        <div class="mt-3">수량 | <input type="number" value="1" id="cart_amount"></div>
      </h5>
    
      <div class="mt-4">
        <button type="button" class="btn btn-dark btn-lg btn-flat" id="btn_buy_add">주문하기</button>
        <button type="button" class="btn btn-dark btn-lg btn-flat" id="btn_cart_add">장바구니</button>
        <button type="button" class="btn btn-outline-dark btn-lg btn-flat" id="btn_wish_add"><i class="bi bi-heart-fill"></i></button>
      </div>

    </div>
    </div>
  </div>


  <div class="row mt-5">
    <div id="tabs" style="border-style: solid;">
      <ul style="background-color: white;">
        <li><a href="#tabs-1">상세정보</a></li>
        <li><a href="#tabs-2">리뷰</a></li>
        <li><a href="#tabs-3">Q&A</a></li>
      </ul>
      <div id="tabs-1">
        <p th:utext="${productVo.pro_content}"></p>
      </div>

      <div id="tabs-2">
        <div class="row mt-3 mb-3">
          <div class="col-10">
            <textarea class="form-control" id="rev_content" rows="3"></textarea>
          </div>
          <div class="col-2">
            <p id="star_rev_score">
              <a class="rev_score" href="#">☆</a>
              <a class="rev_score" href="#">☆</a>
              <a class="rev_score" href="#">☆</a>
              <a class="rev_score" href="#">☆</a>
              <a class="rev_score" href="#">☆</a>
            </p>
            <button type="button" class="btn btn-success mb-2" id="btn_rev_save" th:data-pro_code="${productVo.pro_code}">후기 작성</button>
          </div>
        </div>
        <div class="row">
          <!-- 상품후기 목록 출력 위치-->
          <div class="col" id="reviewList"></div>
        </div>
        <div class="row">
          <!-- 상품후기 페이지 출력 위치-->
          <div class="col" id="reviewPaging"></div>
        </div>
      </div>

      <div id="tabs-3">
        <div class="d-flex justify-content-center">
          <button type="button" id="btnQnaModal" class="btn btn-sm btn-outline-primary" th:data-pro_code="${productVo.pro_code}">
            문의 작성하기
          </button>
        </div>
        <div class="row">
          <!-- 상품문의 목록 출력 위치-->
        <div class="col" id="qnaList"></div>
        </div>
        <div class="row">
          <!-- 상품문의 페이지 출력 위치-->
          <div class="col" id="qnaPaging"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 모달 -->
		<div class="modal fade" id="qnaModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">QnA</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
            <form>
              <div class="form-group">
                <label for="qna_title" class="col-form-label">제목</label><input type="text" class="form-control" id="qna_title" />
                <input type="hidden" class="form-control" id="qna_code" th:value="${QnaVo != null ? qna_code : ''}" />
              </div>
              <div class="form-group">
                <label for="qna_content" class="col-form-label">내용</label>
                <textarea class="form-control" id="qna_content"></textarea>
              </div>
            </form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
						<button type="button" id="btnQnaSave" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 저장하기</button>
						<button type="button" id="btnQnaModify" style="display: none;" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 수정하기 </button>
						<button type="button" id="btnQnaDelete" style="display: none;" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 삭제하기 </button>
					</div>
				</div>
			</div>
		</div>

  <script>

    $(document).ready(function() {
      $("#btn_wish_add").on("click", function () {
        console.log("찜 클릭");

        $.ajax({
          url: '/wish/wish_add',
          type: 'post',
          data: { pro_code: [[${productVo.pro_code}]] },
          dataType: 'text',
          success: function(result) {
            if (result === "success") {
              alert("찜 추가되었습니다.");
              if (confirm("찜 목록으로 이동하시겠습니까?")) {
                location.href = '/wish/wish_list';
              }
            }
          },
          beforeSend: function(xhr) {
            xhr.setRequestHeader("AJAX", "true");
          },
          error: function(xhr, status, error) {
            console.log(xhr);

            if (xhr.status === 401) { // 로그인 필요
              alert("로그인이 필요한 기능입니다.");
              location.href = "/member/login";
            } else {
              alert("이미 찜 목록에 추가한 상품입니다.");
              if(confirm("찜 목록으로 이동하시겠습니까?")) {
                location.href = '/wish/wish_list';
              }
            }
          }
        });
      });


      // 장바구니 클릭이벤트.  id="btn_cart_add"
      $("#btn_cart_add").on("click", function() {
        console.log("장바구니 클릭");

        $.ajax({
          url: '/cart/cart_add',
          type: 'post',
          data: {pro_code: [[${productVo.pro_code}]], cart_amount : $("#cart_amount").val()},
          dataType: 'text',
          success: function(result) {
            if(result == "success") {
              alert("장바구니에 추가되었습니다.");
              if(confirm("장바구니로 이동하시겠습니까?")) {
                location.href = "/cart/cart_list";
              }
            }
          },
          beforeSend : function(xhr) {
            xhr.setRequestHeader("AJAX", "true");
          },
          error : function(xhr, status, error) {
            console.log(xhr);
            alert("로그인이 필요한 기능입니다.");
            location.href = "/member/login";
          }
        });
      });

      // 구매 클릭 btn_buy_add
      $("#btn_buy_add").on("click", function() {
        let cart_amount = $("#cart_amount").val();
        let url = `/order/order_info?pro_code=[[${productVo.pro_code}]]&cart_amount=${cart_amount}&type=buy`;

        location.href = url;
      });


      // 상품후기

      // 상품후기 요청작업
      let pro_code = [[${productVo.pro_code }]];  // 상품코드.  스프링의 model 에서 productVo 이름으로 참조.
      let reviewPage = 1; // 댓글목록의 첫번째 페이지 의미.

      // 댓글목록 불러올 주소
      let url = "/review/rev_list/" + pro_code + "/" + reviewPage;

      console.log("url", url);  // /rev_list/pages/20/1

      getPage(url);

      // 스프링에서 댓글목록과 페이징정보를 ajax기능으로 호출하는 함수
		function getPage(url) {
			
      $("#rev_content").val(""); // 후기평을 지우기
      $("p#star_rev_score a.rev_score").removeClass("on"); // 별평점 초기화

      
      // data : 스프링에서 json포맷으로 보낸 댓글목록과페이징정보데이타 받게된다
			$.getJSON(url, function(data) {
				console.log(data.rev_list); // 상품후기와 답변 목록데이터
				console.log(data.pageMaker); // 댓글 페이징

				// 상품후기와 답변 목록출력함수
				// data.rev_list : 상품후기목록데이타, $("div#reviewList") : 상품후기가 출력될 태그위치  $("#templateReview") : 상품후기 핸들바템플릿
				fn_displayReViewData(data.rev_list, $("div#reviewList"), $("#templateReview"));
				// 페이징출력함수
        // data.pageMaker : 페이징정보데이타, $("div#reviewPaging") : 페이징이 출력될 태그위치
				fn_displayReViewPaging(data.pageMaker, $("div#reviewPaging"))
			});
		};

    // 댓글목록출력함수 : 핸들바 템플릿 사용
		// replyData : json포맷의 댓글목록데이타
		// target : 댓글목록 데이타가 출력될 위치
    // UI작업
		// template : 핸들바 템플릿 
		function fn_displayReViewData(reviewData, target, template) {
			let templateObj = Handlebars.compile(template.html()); //댓글 핸들바템플릿 내용을 문법검사
			let reviewHtml = templateObj(reviewData); // 데이타 + 핸들바템플릿 결합된 결과의 html코드

			target.empty(); // 기존 댓글목록 제거
			target.append(reviewHtml); // 댓글목록이 출력됨

			// update 버튼 숨기기.
			$("table#reviewTable button[name=update]").hide();
		};


		// 페이징출력함수 - 핸들바 템플릿 사용안함.
		function fn_displayReViewPaging(pageData, target) {	

			console.log(pageData);

			let pageStr = '<nav aria-label="Page navigation example">';
				pageStr += '<ul class="pagination">';
			
			
			if(pageData.prev) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.startPage -1)  + '">Previous</a></li>';
			}

			for(let i=pageData.startPage; i <= pageData.endPage; i++) {
				let curPageClass = (pageData.cri.page == i) ? 'active' : '';
				pageStr += '<li class="page-item ' + curPageClass + '"><a class="page-link" href="' + i + '">' + i + '</a></li>';
			}


			if(pageData.next) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.endPage + 1) + '">Next</a></li>';
			}

			pageStr += '</ul>';
			pageStr += '</nav>';

			console.log(pageStr);

			target.empty();
			target.append(pageStr);
		}
    
    // 페이지 번호 클릭설정  1	2	3	4	5 next
    $("div#reviewPaging").on("click", "li a", function(e) {
      e.preventDefault(); // a태그의 링크기능을 제거.
      // $(this) : 선택한 a태그를 참조.
      reviewPage = $(this).attr("href");  // 페이지번호 읽기.

      //console.log("선택한 페이지: ", replyPage); // 3

      //console.log("url", url); //  /replies/pages/3510/1

      url = "/review/rev_list/" + pro_code + "/" + reviewPage;

      getPage(url);
    });

    // 별평점 클릭 이벤트일때 스타일 효과
    $("p#star_rev_score a.rev_score").on("click", function(e) {
     
      e.preventDefault();
      // 기존에 적용했던 a태그(별)들의 on 클래스선택자 제거
      $(this).parent().children().removeClass("on");
      // 선택한 a태그 자신에 on 클래스선택자 적용하고, 이전 a태그(이전 별들)에게도 on 클래스선택자 적용
      $(this).addClass("on").prevAll("a").addClass("on");
    })

    // 상품후기저장 클릭이벤트.  id="btn_rev_save"
    $("button#btn_rev_save").on("click", function() {
      let pro_code = $(this).data("pro_code"); // 상품코드
      let rev_content = $("#rev_content").val(); // 상품평
      let rev_score = 0; // 별평점

      // <a class="rev_score on">★</a> 태그에 class="rev_score on" 이 개수가 몇개인지 체크
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      })

      if(rev_content == "") {
        alert("후기 평을 작성해주세요");
        return;
      }

      if(rev_score == 0) {
        alert("별 평점을 선택하세요.");
        return;
      }
      // REST API 개발방법론 : 서버와클라이언트가 데이타를 JSON포맷으로 주고 받는 특징. https://junvelee.tistory.com/107
      // 데이타 : 자바스크립트 object문법
      let review_data = {pro_code : pro_code, rev_content : rev_content, rev_score : rev_score};

      $.ajax({
        url : '/review/review_save',
        type: 'post',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "POST"
        },
        data : JSON.stringify(review_data), // object문법을 json문자열로 변환
        dataType: 'text',
        success: function(review_count) {
          if(review_count > 0) {
            alert("상품후기 등록됨");

            // 리뷰카운트 id="review_count"
            $("span#review_count").html(review_count);


            reviewPage = 1;
            getPage(url);
          }
        }
      });
    });

    // 수정버튼 이벤트.   name="edit"   reviewList
    $("div#reviewList").on("click", "button[name='edit']", function() {
      let rev_code = $(this).data("rev_code"); // 상품후기코드

      console.log("상품후기코드", rev_code);
      // 현재 선택한 수정버튼 tr안의 td태그를 제거
      let cur_tr = $(this).parent().parent();
      cur_tr.find("td").remove();

      // 수정내용을 화면에 출력.
      $.ajax({
        url : '/review/review_info/' + rev_code,
        type: 'get',
        dataType: 'json',
        success : function(result) {
          
          console.log(result);
          // db에서 가져온 내용을 태그와 결합한 문자열
          let str_rev_code = $(`<td>${result.rev_code}</td>`);
          let str_mbsp_id = $(`<td>${result.mbsp_id}</td>`);
          let str_rev_content = $(`<td><input type="text" name="rev_content" value="${result.rev_content}"></td>`);
          let star_rate = result.rev_score;
         
         
          let tempStr = '<p id="star_rev_score">';
          for(let i=1; i<=5; i++) {
            if(i <= star_rate) {
              tempStr += '<a class="rev_score on" href="#">☆</a>';
            }else {
              tempStr += '<a class="rev_score" href="#">☆</a>';
            }
          }

          tempStr += '</p>';

          let str_star_rate = $(`<td>${tempStr}</td>`);
          let str_rev_date = $(`<td>${result.rev_date}</td>`);
          let str_update_button = $(`<button type="button" name="update" class="btn btn-outline-success btn-sm" data-rev_code="${result.rev_code}">update</button>`);
          let str_cancel_button = $(`<button type="button" name="cancel" class="btn btn-outline-danger btn-sm" data-rev_code="${result.rev_code}">cancel</button>`);

          cur_tr.append(str_rev_code);
          cur_tr.append(str_mbsp_id);
          cur_tr.append(str_rev_content);
          cur_tr.append(str_star_rate);
          cur_tr.append(str_rev_date);
          cur_tr.append(str_update_button);
          cur_tr.append(str_cancel_button);
        }
      });

      // 수정상태에서의 별 클릭이벤트
      $("div#reviewList").on("click", "p#star_rev_score a.rev_score", function(e) {
        e.preventDefault();
        // 기존에 적용했던 a태그(별)들의 on 클래스선택자 제거
        $(this).parent().children().removeClass("on");
        // 선택한 a태그 자신에 on 클래스선택자 적용하고, 이전 a태그(이전 별들)에게도 on 클래스선택자 적용
        $(this).addClass("on").prevAll("a").addClass("on");
      
      });
    });

    // 수정하기 이벤트
    
    $("div#reviewList").on("click", "button[name='update']", function() {
      //console.log("수정하기");

      let rev_code = $(this).data("rev_code"); // 상품후기코드
      
      let cur_tr = $(this).parent().parent();

      let rev_score = 0;

      // <a class="rev_score on">★</a> 태그에 class="rev_score on" 이 개수가 몇개인지 체크
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      })

      console.log("별펑점", rev_score);

      // name="rev_content"

      let  rev_content = cur_tr.find("input[name='rev_content']").val();
      console.log(rev_content);

      // 스프링 작업.
      $.ajax({
        url: '/review/review_modify',
        type: 'put',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "PUT"
        },
        data: JSON.stringify({rev_code : rev_code, rev_score : rev_score, rev_content : rev_content}),
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품후기가 수정되었습니다.");
            
            getPage(url);
          }
        }
      });



      rev_score = 0;

      //getPage(url);
    });

    // 취소
    $("div#reviewList").on("click", "button[name='cancel']", function() {
      getPage(url);

    });


     // 삭제
    $("div#reviewList").on("click", "button[name='delete']", function() {
      
      if(!confirm("상품후기를 삭제하시겠습니까?")) return;

      let rev_code = $(this).data("rev_code");

      console.log("상품후기코드", rev_code);

      $.ajax({
        url: '/review/review_delete/' + rev_code,
        type: 'delete',
        headers: {
          "X-HTTP-Method-Overrid" : "DELETE"
        },
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품후기 삭제되었습니다.");
            
            getPage(url);
          }
        }
      }); 
    }); // 후기 끝

    // QnA

    // Qna 및 페이징 정보 호출 작업
      let qnaPage = 1;
      let qnaUrl = "/qna/qna_list/" + [[${productVo.pro_code}]] + "/" + qnaPage;

      getPage(qnaUrl);

    // ajax 문법으로 주소 요청 작업
      function getPage(qnaUrl) {
        $.getJSON(qnaUrl, function(data) {
          console.log(data.qna_list); 
          console.log(data.pageMaker);

          fn_displayQnaData(data.qna_list, $("div#qnaList"), $("#templateQna"));
          fn_displayQnaPaging(data.pageMaker, $("div#reviewPaging"))
        });
      };


		function fn_displayQnaData(qnaData, target, template) {
			let templateObj = Handlebars.compile(template.html()); //핸들바템플릿 내용을 문법검사
			let qnaHtml = templateObj(qnaData); 

			target.empty(); // 기존 댓글목록 제거
			target.append(qnaHtml); // 댓글목록이 출력됨

			// update 버튼 숨기기.
			$("table#reviewTable button[name=update]").hide();
		};

    // 페이징출력함수 
		function fn_displayQnaPaging(pageData, target) {	

    console.log(pageData);

    let pageStr = '<nav aria-label="Page navigation example">';
      pageStr += '<ul class="pagination">';


    if(pageData.prev) {
      pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.startPage -1)  + '">Previous</a></li>';
    }

    for(let i=pageData.startPage; i <= pageData.endPage; i++) {
      let curPageClass = (pageData.cri.page == i) ? 'active' : '';
      pageStr += '<li class="page-item ' + curPageClass + '"><a class="page-link" href="' + i + '">' + i + '</a></li>';
    }


    if(pageData.next) {
      pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.endPage + 1) + '">Next</a></li>';
    }

    pageStr += '</ul>';
    pageStr += '</nav>';

    console.log(pageStr);

    target.empty();
    target.append(pageStr);
    };

     // 페이지 번호 클릭설정
     $("div#qnaPaging").on("click", "li a", function(e) {
      e.preventDefault(); // a태그의 링크기능을 제거.

      qnaPage = $(this).attr("href");  // 선택한 페이지 번호 값

      url = "/qna/qna_list/" + pro_code + "/" + qnaPage;

      getPage(url);
    });

    // QnA 모달
    $("#btnQnaModal").on("click", function() {
      $("#btnQnaSave").show();
      $("#btnQnaModify").hide();
      $("#btnQnaDelete").hide();
      $("#qna_answer_form").hide();
      $("#qnaModal").modal("show");
    });

    // QnA 모달 리셋
    $("#qnaModal").on("hidden.bs.modal", function() {
      $("#qna_title").val("");
      $("#qna_content").val("");
    });

    // QnA 저장
    $("#btnQnaSave").on("click", function(){ 
      let pro_code = $(this).data("pro_code");
      let qna_title = $("#qna_title").val();
      let qna_content = $("#qna_content").val();

      // console.log("pro_code", pro_code);

      if (qna_title == "") {
        alert("제목을 입력하세요.");
        $("#qna_title").focus();
        return;
      }

      if (qna_content == "") {
        alert("내용을 입력하세요.");
        $("#qna_content").focus();
        return;
      }
      

      let qna_data = {pro_code : pro_code, qna_title : qna_title, qna_content : qna_content};

      console.log("qna_data", qna_data); 
      $.ajax({
        url : '/qna/qna_write',
        type: 'post',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "POST"
        },
        data : JSON.stringify(qna_data), // object문법을 json문자열로 변환
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("QnA가 등록되었습니다.");
            $("#qnaModal").modal("hide");
            qnaPage = 1;
            getPage(qnaUrl);
          }
        }
      });    
    });

    // QnA 수정

    $(document).on("click", ".btn-qna-modify", function() {
    let qna_code = $(this).data("qna_code");
    // let pro_code = $(this).data("pro_code");
    let pro_code = $(this).closest("tr").data("pro_code");
    let qna_title = $(this).data("qna_title");
    let qna_content = $(this).data("qna_content");

    console.log("수정 버튼 클릭됨!");
    console.log("qna_code:", qna_code);
    console.log("pro_code:", pro_code);
    console.log("제목:", qna_title);
    console.log("내용:", qna_content);

    // 모달 내부 값 설정
    $("#qna_code").val(qna_code);
    $("#qna_title").val(qna_title);
    $("#qna_content").val(qna_content);

    // 수정 및 삭제 버튼 표시
    $("#btnQnaSave").hide();
    $("#btnQnaModify").show().data("qna_code", qna_code).data("pro_code", pro_code);
    $("#btnQnaDelete").show().data("qna_code", qna_code);

    // 모달 표시
    $("#qnaModal").modal("show");

});

    $("#btnQnaModify").on("click", function() {
      let pro_code = $(this).data("pro_code");
      let qna_code = $(this).data("qna_code");
      let qna_title = $("#qna_title").val();
      let qna_content = $("#qna_content").val();

      if (qna_title.trim() == "") {
        alert("제목을 입력하세요.");
        $("#qna_title").focus();
        return;
      }

      if (qna_content.trim() == "") {
        alert("내용을 입력하세요.");
        $("#qna_content").focus();
        return;
      }

      let qna_data = {pro_code : pro_code, qna_code : qna_code, qna_title : qna_title, qna_content : qna_content};

      $.ajax({
        url: '/qna/qna_modify',
        type: 'put',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "PUT"
        },
        data: JSON.stringify(qna_data),
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("QnA가 수정되었습니다.");
            $("#btnQnaModify").modal("hide");
            getPage(qnaUrl);
          }
        }
    });
  });

  // QnA 삭제
  $(document).on("click", ".btn-qna-delete", function() {
    if (!confirm("QnA를 삭제하시겠습니까?")) return;

    let qna_code = $(this).data("qna_code");

    $.ajax({
        url: '/qna/qna_delete/' + qna_code,
        type: 'DELETE',
        headers: { "X-HTTP-Method-Overrid": "DELETE" },
        dataType: 'text',
        success: function(result) {
            if (result === "success") {
                alert("QnA가 삭제되었습니다.");
                getPage(qnaUrl);  // 리스트 갱신
            }
        }
    });
});

    }); // ready 끝

  </script>
</th:block>
</html>

모달 상품 리뷰

      // 상품리뷰 요청작업
      let pro_code = [[${productVo.pro_code }]];  // 상품코드.  스프링의 model 에서 productVo 이름으로 참조.
      let reviewPage = 1; // 댓글목록의 첫번째 페이지 의미.
      // 댓글목록 불러올 주소
      let reviewUrl = "/review/rev_list/" + pro_code + "/" + reviewPage;

      getPage(reviewUrl);

      // ajax 문법으로 주소 요청 작업
      function getPage(reviewUrl) {
        $.getJSON(reviewUrl, function(data) {

          fn_displayReViewData(data.rev_list, $("div#reviewList"), $("#templateReview"));
          fn_displayReViewPaging(data.pageMaker, $("div#reviewPaging"))
        });
      };

      function fn_displayReViewData(reviewData, target, template) {
			let templateObj = Handlebars.compile(template.html()); //댓글 핸들바템플릿 내용을 문법검사
			let reviewHtml = templateObj(reviewData); // 데이타 + 핸들바템플릿 결합된 결과의 html코드

			target.empty(); // 기존 댓글목록 제거
			target.append(reviewHtml); // 댓글목록이 출력됨

			// update 버튼 숨기기.
			$("table#reviewTable button[name=update]").hide();
		};

		// 페이징출력함수 - 핸들바 템플릿 사용안함.
		function fn_displayReViewPaging(pageData, target) {	

			console.log(pageData);

			let pageStr = '<nav aria-label="Page navigation example">';
				pageStr += '<ul class="pagination">';
			
			
			if(pageData.prev) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.startPage -1)  + '">Previous</a></li>';
			}

			for(let i=pageData.startPage; i <= pageData.endPage; i++) {
				let curPageClass = (pageData.cri.page == i) ? 'active' : '';
				pageStr += '<li class="page-item ' + curPageClass + '"><a class="page-link" href="' + i + '">' + i + '</a></li>';
			}


			if(pageData.next) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.endPage + 1) + '">Next</a></li>';
			}

			pageStr += '</ul>';
			pageStr += '</nav>';

			console.log(pageStr);

			target.empty();
			target.append(pageStr);
		}
    
    // 페이지 번호 클릭설정  1	2	3	4	5 next
    $("div#reviewPaging").on("click", "li a", function(e) {
      reviewPage = $(this).attr("href");  

      url = "/review/rev_list/" + pro_code + "/" + reviewPage;

      getPage(url);
    });

    // 리뷰 모달
    $("#btnReviewModal").on("click", function() {
      $("#btnReviewSave").show();
      $("#btnReviewModify").hide();
      $("#reviewModal").modal("show");
    });

    // 리뷰 모달 리셋
    $("#reviewModal").on("hidden.bs.modal", function() {
      $("#rev_title").val("");
      $("p#star_rev_score a.rev_score").removeClass("on");
      $("#rev_content").val("");
    });

    // 별점 클릭
    $("p#star_rev_score a.rev_score").on("click", function(e) {
      e.preventDefault();
      $(this).parent().children().removeClass("on"); // on 선택자 제거
      $(this).addClass("on").prevAll("a").addClass("on"); // 현재 별과 이전별까지 on 선택자 추가
    });

    // 리뷰 저장
    $("#btnReviewSave").on("click", function() {
      let pro_code = $(this).data("pro_code"); 
      let rev_title = $("#rev_title").val();
      let rev_content = $("#rev_content").val(); 
      let rev_score = 0; 

      // 별점 개수 확인
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      })

      if(rev_title == "") {
        alert("리뷰 제목을 작성해주세요");
        return;
      }

      if(rev_content == "") {
        alert("리뷰 내용을 작성해주세요");
        return;
      }

      if(rev_score == 0) {
        alert("별 평점을 선택하세요.");
        return;
      } // return;

      let review_data = {pro_code : pro_code, rev_title: rev_title, rev_content : rev_content, rev_score : rev_score};

      $.ajax({
        url : '/review/review_save',
        type: 'post',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "POST"
        },
        data : JSON.stringify(review_data), // object문법을 json문자열로 변환
        dataType: 'text',
        success: function(review_count) {
          if(review_count > 0) {
            alert("상품리뷰가 등록되었습니다.");

            // 리뷰카운트 id="review_count"
            $("span#review_count").html(review_count);


            reviewPage = 1;
            getPage(reviewUrl);
          } else if (result == "fail") {
            alert("로그인이 필요한 기능입니다.");
            location.href = "/member/login";
          }
        }
      });
    });

    // 리뷰 수정
    $(document).on("click", ".btn-rev-modify", function() {
    let rev_code = $(this).data("rev_code");

    console.log("수정 버튼 클릭됨! rev_code:", rev_code);
    console.log("제목", rev_title);
    console.log("내용", rev_content);
    console.log("별점", rev_score);

    $.ajax({
        url: '/review/review_info/' + rev_code, 
        type: 'get',
        dataType: 'json',
        success: function(result) {
            console.log("받아온 데이터:", result);

            // 모달 내부 입력 필드에 값 설정
            $("#rev_code").val(result.rev_code);
            $("#rev_title").val(result.rev_title);
            $("#rev_content").val(result.rev_content);

            let rev_score= result.rev_score;

            $("p#star_rev_score a.rev_score").each(function (index, item) {
              if (index < rev_score) {
                $(this).addClass("on");
              }
            });

            // 수정 및 삭제 버튼 표시
            $("#btnReviewSave").hide();
            $("#btnReviewModify").show().data("qna_code", qna_code);

            // 모달 표시
            $("#reviewModal").modal("show").on('shown.bs.modal', function () {
                $("#rev_title").focus();
            });

        }
    });
  });

    // 리뷰 수정 저장
    $("#btnReviewModify").on("click", function () {
      let pro_code = $(this).data("pro_code");
      let rev_code = $(this).data("rev_code");
      let rev_title = $("#rev_title").val();
      let rev_content = $("#rev_content").val();
      let rev_score= 0;

      // 별점 수정
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      });

      if (rev_title == "") {
          alert("제목을 입력하세요.");
          $("#rev_title").focus();
          return;
        }

        if (rev_content == "") {
          alert("내용을 입력하세요.");
          $("#rev_content").focus();
          return;
        }

        if (rev_score == 0) {
          alert("평점을 선택하세요.");
          $("#rev_score").focus();
          return;
        }

      $.ajax({
        url: '/review/review_modify',
        type: 'put',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "PUT"
        },
        data: JSON.stringify({rev_code : rev_code, rev_score : rev_score, rev_content : rev_content}),
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품리뷰가 수정되었습니다.");
            $("#reviewModal").modal("hide");
            getPage(reviewUrl);
          }
        }
      });
    });

     // 삭제
     $(document).on("click", ".btn-rev-delete", function() {
      
      if(!confirm("상품리뷰를 삭제하시겠습니까?")) return;

      let rev_code = $(this).data("rev_code");

      console.log("상품리뷰코드", rev_code);

      $.ajax({
        url: '/review/review_delete/' + rev_code,
        type: 'delete',
        headers: {
          "X-HTTP-Method-Overrid" : "DELETE"
        },
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품리뷰가 삭제되었습니다.");
            
            getPage(reviewUrl);
          }
        }
      }); // 리뷰 끝
     });





     <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<th:block layout:fragment="css">
  <style>
    /* 별평점 기본효과 스타일 */
    p#star_rev_score a.rev_score {
      font-size: 22px;
      text-decoration: none;
      color: lightgray;
    }

    /* 별평점에 클릭했을 경우 선택자 */
    p#star_rev_score a.rev_score.on {
      color: goldenrod;
    }
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css");


    #tabs ul li {
    background-color: #f8f9fa;
    border: 1px solid #ccc;
    display: inline-block;
    cursor: pointer;
}

/* 활성화된 탭 스타일 */
#tabs ul li.ui-tabs-active {
    background-color: black; 
    color: white;
    font-weight: bold;
}
  </style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
</th:block>

<th:block layout:fragment="script">


<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
  <script>
    $( function() {
      $( "#tabs" ).tabs();
    } );
    </script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script id="templateReview" type="text/x-handlebars-template">
      <table class="table" id="reviewTable">
        <tbody>
          {{#each .}}
          <tr>
            <td>{{rev_code}}</td>
            <td>{{mem_id}}</td>
            <td>{{rev_title}}</td>
            <td>{{rev_content}}</td>
            <td>{{displayStar rev_score}}</td>
            <td>{{convertDate rev_date}}</td>
            <td>
              {{authControlView mem_id rev_code}}
            </td>
          </tr>
          {{#if replies.length}}
          {{#each replies}}
          <tr>
            <td colspan="6">[관리자] 답변글 : {{reply_content}} 작성일 : {{convertDate reply_date}}</td>
          </tr>
            {{/each}}
            {{/if}}
            {{/each}}
        </tbody>
      </table>
    </script>

    <script id="templateQna" type="text/x-handlebars-template">
      <table class="table" id="qnaTable">
        <tbody>
          {{#each .}}
          <tr>
            <td>{{qna_code}}</td>
            <td>{{mem_id}}</td>
            <td>{{qna_title}}</td>
            <td>{{qna_content}}</td>
            <td>{{convertDate qna_date}}</td>
            <td>
              {{authControlView mem_id qna_code}}
            </td>
          </tr>
          {{#if answer.length}}
          {{#each answer}}
          <tr>
            <td colspan="6">[관리자] 답변글 : {{ans_content}} 작성일 : {{convertDate ans_date}}</td></td>
          </tr>
            {{/each}}
            {{/if}}
            {{/each}}
        </tbody>
      </table>
    </script>

    <script th:inline="javascript">
      // 핸들바 템플릿에서 사용자정의 함수 : 후기작성시간 포맷(형식)
      Handlebars.registerHelper("convertDate", function(reviewDate) {
        const date = new Date(reviewDate);
  
        let month = (date.getMonth()+1 < 10 ? "0" + (date.getMonth()+1) : date.getMonth()+1);
        let day = (date.getDate() < 10 ? "0" + (date.getDate()) : date.getDate());
        let hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
        let minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
        let second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
        return date.getFullYear() + "/" + month + "/" + day + " " + hour + ":" + minute + ":" + second;
      });

      // 핸들바 템플릿 사용자 정의 함수- 로그인 사용자와 후기 작성자가 같을 때만 수정,삭제 버튼 표시하기
      Handlebars.registerHelper("authControlView", function(mem_id, rev_code) {
        console.log("작성자", mem_id);
        console.log("후기번호", rev_code)
        // 로그인 사용자는 세션으로 확인한다.
        let memberVo = [[${session.login_auth}]];

        let loginId = "";

        if(memberVo !== null) { // 로그인
          loginId = [[${session.login_auth == null? '' : session.login_auth.mem_id}]];
        }

        console.log("아이디", loginId);

        let str = "";

        // 로그인상태이며 로그인=후기아이디 일치 시
        if(memberVo !== null && loginId == mem_id) {
          str += `<button type="button" name="delete" class="btn btn-outline-danger btn-sm ml-3" data-rev_code="${rev_code}">delete</button>`;
          str += `<button type="button" name="edit" class="btn btn-outline-info btn-sm" data-rev_code="${rev_code}">edit</button>`;

          return new Handlebars.SafeString(str);
        }else {
          return str;
        }
      });

      // 평점 별표시 핸들바 사용자정의 함수
      Handlebars.registerHelper("displayStar", function(rating) {
        let star = "";
        switch(rating) {
          case 1:
            star = "★☆☆☆☆";
            break;
          case 2:
            star = "★★☆☆☆";
            break;
          case 3:
            star = "★★★☆☆";
            break;
          case 4:
            star = "★★★★☆";
            break;
          case 5:
            star = "★★★★★";
            break;
        }
        return star;
      });
 </script>  

<script th:inline="javascript">
  // 핸들바 템플릿에서 사용자정의 함수 : QnA작성시간 포맷(형식)
  Handlebars.registerHelper("convertDate", function(qnaDate) {
    const date = new Date(qnaDate);

    let month = (date.getMonth()+1 < 10 ? "0" + (date.getMonth()+1) : date.getMonth()+1);
    let day = (date.getDate() < 10 ? "0" + (date.getDate()) : date.getDate());
    let hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
    let minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
    let second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
    return date.getFullYear() + "/" + month + "/" + day + " " + hour + ":" + minute + ":" + second;
  });

  Handlebars.registerHelper("authControlView", function(mem_id, qna_code) {
    console.log("작성자", mem_id);
    console.log("문의번호", qna_code)
    let memberVo = [[${session.login_auth}]];

    let loginId = "";

    if(memberVo !== null) { 
      loginId = [[${session.login_auth == null? '' : session.login_auth.mem_id}]];
    }

    console.log("아이디", loginId);

    let str = "";

    if(memberVo !== null && loginId == mem_id) {
      // str += `<button type="button" id="btnQnaModify" class="btn btn-outline-success btn-sm ml-3" data-qna_code="${qna_code}">수정</button>`;
      // str += `<button type="button" id="btnQnaDelete" class="btn btn-outline-info btn-sm" data-qna_code="${qna_code}">삭제</button>`;
      // str += `<button type="button" class="btn btn-outline-success btn-sm ml-3 btn-qna-modify" data-qna_code="${qna_code}">수정</button>`;
      str += `<button type="button" class="btn btn-outline-info btn-sm btn-rev-delete" data-qna_code="${qna_code}">삭제</button>`;
      str += `<button type="button" class="btn btn-outline-success btn-sm ml-3 btn-rev-modify" 
         data-qna_code="${qna_code}" 
         data-qna_title="${qna_title}" 
         data-qna_content="${qna_content}">
         수정
       </button>`;



      return new Handlebars.SafeString(str);
    }else {
      return str;
    }
  });
  </script> 

  <!-- <script th:inline="javascript">
  // 공통: 날짜 변환 헬퍼 (리뷰, QnA 모두 사용 가능)
  Handlebars.registerHelper("convertDate", function(dateStr) {
    if (!dateStr) return ""; // null 또는 undefined 체크

    const date = new Date(dateStr);
    let month = (date.getMonth() + 1).toString().padStart(2, "0");
    let day = date.getDate().toString().padStart(2, "0");
    let hour = date.getHours().toString().padStart(2, "0");
    let minute = date.getMinutes().toString().padStart(2, "0");
    let second = date.getSeconds().toString().padStart(2, "0");

    return `${date.getFullYear()}/${month}/${day} ${hour}:${minute}:${second}`;
  });

  // 로그인 사용자와 작성자가 같을 때만 수정, 삭제 버튼 표시 (리뷰용)
  Handlebars.registerHelper("authControlView", function(mem_id, rev_code, rev_title, rev_content, rev_score) {
    let memberVo = [[${session.login_auth}]];
    let loginId = (memberVo && memberVo.mem_id) ? memberVo.mem_id : "";
    let str = "";

    if (memberVo !== null && loginId == mem_id) {
      str += `<button type="button" class="btn btn-outline-info btn-sm btn-rev-delete" data-rev_code="${rev_code}">삭제</button>`;
      str += `<button type="button" class="btn btn-outline-success btn-sm ml-3 btn-rev-modify" 
                data-rev_code="${rev_code}"
                data-rev_title="${rev_title || ''}"
                data-rev_content="${rev_content || ''}"
                data-rev_score="${rev_score || ''}">
                수정
              </button>`;
    }
    return new Handlebars.SafeString(str);
  });

  // 로그인 사용자와 작성자가 같을 때만 수정, 삭제 버튼 표시 (QnA용)
  Handlebars.registerHelper("authControlQna", function(mem_id, qna_code, qna_title, qna_content) {
    let memberVo = [[${session.login_auth}]];
    let loginId = (memberVo && memberVo.mem_id) ? memberVo.mem_id : "";
    let str = "";

    if (memberVo !== null && loginId == mem_id) {
      str += `<button type="button" class="btn btn-outline-info btn-sm btn-qna-delete" data-qna_code="${qna_code}">삭제</button>`;
      str += `<button type="button" class="btn btn-outline-success btn-sm ml-3 btn-qna-modify" 
                data-qna_code="${qna_code}"
                data-qna_title="${qna_title || ''}"
                data-qna_content="${qna_content || ''}">
                수정
              </button>`;
    }
    return new Handlebars.SafeString(str);
  });

  // 평점 별 표시 헬퍼
  Handlebars.registerHelper("displayStar", function(rating) {
    const stars = ["", "★☆☆☆☆", "★★☆☆☆", "★★★☆☆", "★★★★☆", "★★★★★"];
    return stars[rating] || "";
  });
</script> -->

</th:block>

<th:block layout:fragment="content">


  <div class="row">
    <div class="col-12 col-sm-6">
      <h3 th:utext="${cate_name}"></h3>
      <div class="col-12">
        <img style="width: 80%;height: 350px;" th:src="${'/product/image_display?dateFolderName=' + productVo.pro_up_folder + '&fileName=' + productVo.pro_img}">
      </div>
    </div>
    <div class="col-12 col-sm-6">
      <h3 class="mt-3" th:text="${productVo.pro_name}">제품명</h3>
      <small class="text-body-secondary">상품 리뷰 : <span id="review_count" th:text="${productVo.pro_review}"></span></small>
      <hr>

      <div class="bg-gray py-2 px-3 mt-4">
      <h5 class="mb-0">
        <div class="mt-3">가격 | <span>[[${#numbers.formatInteger(productVo.pro_price, 3, 'COMMA') + '원'}]]</span></div>
      </h5>
      <h5 class="mb-0">
        <div class="mt-3">할인율 | <span th:text="${productVo.pro_discount}"></span></div>
      <h5 class="mb-0">
        <div class="mt-3">출판사 | <span th:text="${productVo.pro_publisher}"></span></div>
      </h5>
      <h5 class="mb-0">
        <div class="mt-3">수량 | <input type="number" value="1" id="cart_amount"></div>
      </h5>
    
      <div class="mt-4">
        <button type="button" class="btn btn-dark btn-lg btn-flat" id="btn_buy_add">주문하기</button>
        <button type="button" class="btn btn-dark btn-lg btn-flat" id="btn_cart_add">장바구니</button>
        <button type="button" class="btn btn-outline-dark btn-lg btn-flat" id="btn_wish_add"><i class="bi bi-heart-fill"></i></button>
      </div>

    </div>
    </div>
  </div>


  <div class="row mt-5">
    <div id="tabs" style="border-style: solid;">
      <ul style="background-color: white;">
        <li><a href="#tabs-1">상세정보</a></li>
        <li><a href="#tabs-2">리뷰</a></li>
        <li><a href="#tabs-3">Q&A</a></li>
      </ul>
      <div id="tabs-1">
        <p th:utext="${productVo.pro_content}"></p>
      </div>

      <div class="row mt-5">
        <div id="tabs" style="border-style: solid;">
          <ul style="background-color: white;">
            <li><a href="#tabs-1">상세정보</a></li>
            <li><a href="#tabs-2">리뷰</a></li>
            <li><a href="#tabs-3">Q&A</a></li>
          </ul>
          <div id="tabs-1">
            <p th:utext="${productVo.pro_content}"></p>
          </div>
    
          <div id="tabs-2">
            <div class="row mt-3 mb-3">
              <div class="col-10">
                <textarea class="form-control" id="rev_content" rows="3"></textarea>
              </div>
              <div class="col-2">
                <p id="star_rev_score">
                  <a class="rev_score" href="#">☆</a>
                  <a class="rev_score" href="#">☆</a>
                  <a class="rev_score" href="#">☆</a>
                  <a class="rev_score" href="#">☆</a>
                  <a class="rev_score" href="#">☆</a>
                </p>
                <button type="button" class="btn btn-success mb-2" id="btn_rev_save" th:data-pro_code="${productVo.pro_code}">후기 작성</button>
              </div>
            </div>
            <div class="row">
              <!-- 상품후기 목록 출력 위치-->
              <div class="col" id="reviewList"></div>
            </div>
            <div class="row">
              <!-- 상품후기 페이지 출력 위치-->
              <div class="col" id="reviewPaging"></div>
            </div>
          </div>

      <div id="tabs-3">
        <div class="d-flex justify-content-center">
          <button type="button" id="btnQnaModal" class="btn btn-sm btn-outline-primary" th:data-pro_code="${productVo.pro_code}">
            문의 작성하기
          </button>
        </div>
        <div class="row">
          <!-- 상품문의 목록 출력 위치-->
        <div class="col" id="qnaList"></div>
        </div>
        <div class="row">
          <!-- 상품문의 페이지 출력 위치-->
          <div class="col" id="qnaPaging"></div>
        </div>
      </div>
    </div>
  </div>

  <!--리뷰 모달 
  <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Review</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="rev_title" class="col-form-label">제목</label><input type="text" class="form-control" id="rev_title" />
              <input type="hidden" class="form-control" id="rev_code" th:value="${ReviewVo != null ? rev_code : ''}" />
            </div>
            <div class="form-group">
              <label for="rev_score" class="col-form-label">별점</label>
              <p id="star_rev_score">
                <a class="rev_score" href="#">☆</a>
                <a class="rev_score" href="#">☆</a>
                <a class="rev_score" href="#">☆</a>
                <a class="rev_score" href="#">☆</a>
                <a class="rev_score" href="#">☆</a>
              </p>
            </div>
            <div class="form-group">
              <label for="rev_content" class="col-form-label">내용</label>
              <textarea class="form-control" id="rev_content"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="button" id="btnReviewSave" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">리뷰 저장하기</button>
          <button type="button" id="btnReivewModify" style="display: none;" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">리뷰 수정하기 </button>
        </div>
      </div>
    </div>
  </div>-->


  <!--QnA 모달 -->
		<div class="modal fade" id="qnaModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">QnA</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
            <form>
              <div class="form-group">
                <label for="qna_title" class="col-form-label">제목</label><input type="text" class="form-control" id="qna_title" />
                <input type="hidden" class="form-control" id="qna_code" th:value="${QnaVo != null ? qna_code : ''}" />
              </div>
              <div class="form-group">
                <label for="qna_content" class="col-form-label">내용</label>
                <textarea class="form-control" id="qna_content"></textarea>
              </div>
            </form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
						<button type="button" id="btnQnaSave" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 저장하기</button>
						<button type="button" id="btnQnaModify" style="display: none;" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 수정하기 </button>
						<button type="button" id="btnQnaDelete" style="display: none;" class="btn btn-secondary" th:data-pro_code="${productVo.pro_code}">문의 삭제하기 </button>
					</div>
				</div>
			</div>
		</div>

  <script>

    $(document).ready(function() {
      $("#btn_wish_add").on("click", function () {
        console.log("찜 클릭");

        $.ajax({
          url: '/wish/wish_add',
          type: 'post',
          data: { pro_code: [[${productVo.pro_code}]] },
          dataType: 'text',
          success: function(result) {
            if (result === "success") {
              alert("찜 추가되었습니다.");
              if (confirm("찜 목록으로 이동하시겠습니까?")) {
                location.href = '/wish/wish_list';
              }
            }
          },
          beforeSend: function(xhr) {
            xhr.setRequestHeader("AJAX", "true");
          },
          error: function(xhr, status, error) {
            console.log(xhr);

            if (xhr.status === 401) { // 로그인 필요
              alert("로그인이 필요한 기능입니다.");
              location.href = "/member/login";
            } else {
              alert("이미 찜 목록에 추가한 상품입니다.");
              if(confirm("찜 목록으로 이동하시겠습니까?")) {
                location.href = '/wish/wish_list';
              }
            }
          }
        });
      });
    });


      // 장바구니 클릭이벤트.  id="btn_cart_add"
      $("#btn_cart_add").on("click", function() {
        console.log("장바구니 클릭");

        $.ajax({
          url: '/cart/cart_add',
          type: 'post',
          data: {pro_code: [[${productVo.pro_code}]], cart_amount : $("#cart_amount").val()},
          dataType: 'text',
          success: function(result) {
            if(result == "success") {
              alert("장바구니에 추가되었습니다.");
              if(confirm("장바구니로 이동하시겠습니까?")) {
                location.href = "/cart/cart_list";
              }
            }
          },
          beforeSend : function(xhr) {
            xhr.setRequestHeader("AJAX", "true");
          },
          error : function(xhr, status, error) {
            console.log(xhr);
            alert("로그인이 필요한 기능입니다.");
            location.href = "/member/login";
          }
        });
      });

      // 구매 클릭 btn_buy_add
      $("#btn_buy_add").on("click", function() {
        let cart_amount = $("#cart_amount").val();
        let url = `/order/order_info?pro_code=[[${productVo.pro_code}]]&cart_amount=${cart_amount}&type=buy`;

        location.href = url;
      });


      // 상품후기

      // 상품후기 요청작업
      let pro_code = [[${productVo.pro_code }]];  // 상품코드.  스프링의 model 에서 productVo 이름으로 참조.
      let reviewPage = 1; // 댓글목록의 첫번째 페이지 의미.

      // 댓글목록 불러올 주소
      let url = "/review/rev_list/" + pro_code + "/" + reviewPage;

      console.log("url", url);  // /rev_list/pages/20/1

      getPage(url);

      // 스프링에서 댓글목록과 페이징정보를 ajax기능으로 호출하는 함수
		function getPage(url) {
			
      $("#rev_content").val(""); // 후기평을 지우기
      $("p#star_rev_score a.rev_score").removeClass("on"); // 별평점 초기화

      
      // data : 스프링에서 json포맷으로 보낸 댓글목록과페이징정보데이타 받게된다
			$.getJSON(url, function(data) {
				console.log(data.rev_list); // 상품후기와 답변 목록데이터
				console.log(data.pageMaker); // 댓글 페이징

				// 상품후기와 답변 목록출력함수
				// data.rev_list : 상품후기목록데이타, $("div#reviewList") : 상품후기가 출력될 태그위치  $("#templateReview") : 상품후기 핸들바템플릿
				fn_displayReViewData(data.rev_list, $("div#reviewList"), $("#templateReview"));
				// 페이징출력함수
        // data.pageMaker : 페이징정보데이타, $("div#reviewPaging") : 페이징이 출력될 태그위치
				fn_displayReViewPaging(data.pageMaker, $("div#reviewPaging"))
			});
		};

    // 댓글목록출력함수 : 핸들바 템플릿 사용
		// replyData : json포맷의 댓글목록데이타
		// target : 댓글목록 데이타가 출력될 위치
    // UI작업
		// template : 핸들바 템플릿 
		function fn_displayReViewData(reviewData, target, template) {
			let templateObj = Handlebars.compile(template.html()); //댓글 핸들바템플릿 내용을 문법검사
			let reviewHtml = templateObj(reviewData); // 데이타 + 핸들바템플릿 결합된 결과의 html코드

			target.empty(); // 기존 댓글목록 제거
			target.append(reviewHtml); // 댓글목록이 출력됨

			// update 버튼 숨기기.
			$("table#reviewTable button[name=update]").hide();
		};


		// 페이징출력함수 - 핸들바 템플릿 사용안함.
		function fn_displayReViewPaging(pageData, target) {	

			console.log(pageData);

			let pageStr = '<nav aria-label="Page navigation example">';
				pageStr += '<ul class="pagination">';
			
			
			if(pageData.prev) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.startPage -1)  + '">Previous</a></li>';
			}

			for(let i=pageData.startPage; i <= pageData.endPage; i++) {
				let curPageClass = (pageData.cri.page == i) ? 'active' : '';
				pageStr += '<li class="page-item ' + curPageClass + '"><a class="page-link" href="' + i + '">' + i + '</a></li>';
			}


			if(pageData.next) {
				pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.endPage + 1) + '">Next</a></li>';
			}

			pageStr += '</ul>';
			pageStr += '</nav>';

			console.log(pageStr);

			target.empty();
			target.append(pageStr);
		}
    
    // 페이지 번호 클릭설정  1	2	3	4	5 next
    $("div#reviewPaging").on("click", "li a", function(e) {
      e.preventDefault(); // a태그의 링크기능을 제거.
      // $(this) : 선택한 a태그를 참조.
      reviewPage = $(this).attr("href");  // 페이지번호 읽기.

      //console.log("선택한 페이지: ", replyPage); // 3

      //console.log("url", url); //  /replies/pages/3510/1

      url = "/review/rev_list/" + pro_code + "/" + reviewPage;

      getPage(url);
    });

    // 별평점 클릭 이벤트일때 스타일 효과
    $("p#star_rev_score a.rev_score").on("click", function(e) {
     
      e.preventDefault();
      // 기존에 적용했던 a태그(별)들의 on 클래스선택자 제거
      $(this).parent().children().removeClass("on");
      // 선택한 a태그 자신에 on 클래스선택자 적용하고, 이전 a태그(이전 별들)에게도 on 클래스선택자 적용
      $(this).addClass("on").prevAll("a").addClass("on");
    })

    // 상품후기저장 클릭이벤트.  id="btn_rev_save"
    $("button#btn_rev_save").on("click", function() {
      let pro_code = $(this).data("pro_code"); // 상품코드
      let rev_content = $("#rev_content").val(); // 상품평
      let rev_score = 0; // 별평점

      // <a class="rev_score on">★</a> 태그에 class="rev_score on" 이 개수가 몇개인지 체크
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      })

      if(rev_content == "") {
        alert("후기 평을 작성해주세요");
        return;
      }

      if(rev_score == 0) {
        alert("별 평점을 선택하세요.");
        return;
      }
      // REST API 개발방법론 : 서버와클라이언트가 데이타를 JSON포맷으로 주고 받는 특징. https://junvelee.tistory.com/107
      // 데이타 : 자바스크립트 object문법
      let review_data = {pro_code : pro_code, rev_content : rev_content, rev_score : rev_score};

      $.ajax({
        url : '/review/review_save',
        type: 'post',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "POST"
        },
        data : JSON.stringify(review_data), // object문법을 json문자열로 변환
        dataType: 'text',
        success: function(review_count) {
          if(review_count > 0) {
            alert("상품후기 등록됨");

            // 리뷰카운트 id="review_count"
            $("span#review_count").html(review_count);


            reviewPage = 1;
            getPage(url);
          }
        }
      });
    });

    // 수정버튼 이벤트.   name="edit"   reviewList
    $("div#reviewList").on("click", "button[name='edit']", function() {
      let rev_code = $(this).data("rev_code"); // 상품후기코드

      console.log("상품후기코드", rev_code);
      // 현재 선택한 수정버튼 tr안의 td태그를 제거
      let cur_tr = $(this).parent().parent();
      cur_tr.find("td").remove();

      // 수정내용을 화면에 출력.
      $.ajax({
        url : '/review/review_info/' + rev_code,
        type: 'get',
        dataType: 'json',
        success : function(result) {
          
          console.log(result);
          // db에서 가져온 내용을 태그와 결합한 문자열
          let str_rev_code = $(`<td>${result.rev_code}</td>`);
          let str_mbsp_id = $(`<td>${result.mbsp_id}</td>`);
          let str_rev_content = $(`<td><input type="text" name="rev_content" value="${result.rev_content}"></td>`);
          let star_rate = result.rev_score;
         
         
          let tempStr = '<p id="star_rev_score">';
          for(let i=1; i<=5; i++) {
            if(i <= star_rate) {
              tempStr += '<a class="rev_score on" href="#">☆</a>';
            }else {
              tempStr += '<a class="rev_score" href="#">☆</a>';
            }
          }

          tempStr += '</p>';

          let str_star_rate = $(`<td>${tempStr}</td>`);
          let str_rev_date = $(`<td>${result.rev_date}</td>`);
          let str_update_button = $(`<button type="button" name="update" class="btn btn-outline-success btn-sm" data-rev_code="${result.rev_code}">update</button>`);
          let str_cancel_button = $(`<button type="button" name="cancel" class="btn btn-outline-danger btn-sm" data-rev_code="${result.rev_code}">cancel</button>`);

          cur_tr.append(str_rev_code);
          cur_tr.append(str_mbsp_id);
          cur_tr.append(str_rev_content);
          cur_tr.append(str_star_rate);
          cur_tr.append(str_rev_date);
          cur_tr.append(str_update_button);
          cur_tr.append(str_cancel_button);
        }
      });

      // 수정상태에서의 별 클릭이벤트
      $("div#reviewList").on("click", "p#star_rev_score a.rev_score", function(e) {
        e.preventDefault();
        // 기존에 적용했던 a태그(별)들의 on 클래스선택자 제거
        $(this).parent().children().removeClass("on");
        // 선택한 a태그 자신에 on 클래스선택자 적용하고, 이전 a태그(이전 별들)에게도 on 클래스선택자 적용
        $(this).addClass("on").prevAll("a").addClass("on");
      
      });
    });

    // 수정하기 이벤트
    
    $("div#reviewList").on("click", "button[name='update']", function() {
      //console.log("수정하기");

      let rev_code = $(this).data("rev_code"); // 상품후기코드
      
      let cur_tr = $(this).parent().parent();

      let rev_score = 0;

      // <a class="rev_score on">★</a> 태그에 class="rev_score on" 이 개수가 몇개인지 체크
      $("p#star_rev_score a.rev_score").each(function() {
        if($(this).attr("class") == "rev_score on") {
          rev_score += 1;
        }
      })

      console.log("별펑점", rev_score);

      // name="rev_content"

      let  rev_content = cur_tr.find("input[name='rev_content']").val();
      console.log(rev_content);

      // 스프링 작업.
      $.ajax({
        url: '/review/review_modify',
        type: 'put',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "PUT"
        },
        data: JSON.stringify({rev_code : rev_code, rev_score : rev_score, rev_content : rev_content}),
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품후기가 수정되었습니다.");
            
            getPage(url);
          }
        }
      });



      rev_score = 0;

      //getPage(url);
    });

    // 취소
    $("div#reviewList").on("click", "button[name='cancel']", function() {
      getPage(url);

    });


     // 삭제
    $("div#reviewList").on("click", "button[name='delete']", function() {
      
      if(!confirm("상품후기를 삭제하시겠습니까?")) return;

      let rev_code = $(this).data("rev_code");

      console.log("상품후기코드", rev_code);

      $.ajax({
        url: '/review/review_delete/' + rev_code,
        type: 'delete',
        headers: {
          "X-HTTP-Method-Overrid" : "DELETE"
        },
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("상품후기 삭제되었습니다.");
            
            getPage(url);
          }
        }
      }); 
    }); // 후기 끝
      

    // QnA

    // Qna 및 페이징 정보 호출 작업
      let qnaPage = 1;
      let qnaUrl = "/qna/qna_list/" + [[${productVo.pro_code}]] + "/" + qnaPage;

      getPage(qnaUrl);

    // ajax 문법으로 주소 요청 작업
      function getPage(qnaUrl) {
        $.getJSON(qnaUrl, function(data) {
          console.log(data.qna_list); 
          console.log(data.pageMaker);

          fn_displayQnaData(data.qna_list, $("div#qnaList"), $("#templateQna"));
          fn_displayQnaPaging(data.pageMaker, $("div#reviewPaging"))
        });
      };


		function fn_displayQnaData(qnaData, target, template) {
			let templateObj = Handlebars.compile(template.html()); //핸들바템플릿 내용을 문법검사
			let qnaHtml = templateObj(qnaData); 

			target.empty(); // 기존 댓글목록 제거
			target.append(qnaHtml); // 댓글목록이 출력됨

			// update 버튼 숨기기.
			$("table#reviewTable button[name=update]").hide();
		};

    // 페이징출력함수 
		function fn_displayQnaPaging(pageData, target) {	

    console.log(pageData);

    let pageStr = '<nav aria-label="Page navigation example">';
      pageStr += '<ul class="pagination">';


    if(pageData.prev) {
      pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.startPage -1)  + '">Previous</a></li>';
    }

    for(let i=pageData.startPage; i <= pageData.endPage; i++) {
      let curPageClass = (pageData.cri.page == i) ? 'active' : '';
      pageStr += '<li class="page-item ' + curPageClass + '"><a class="page-link" href="' + i + '">' + i + '</a></li>';
    }


    if(pageData.next) {
      pageStr += '<li class="page-item"><a class="page-link" href="' + (pageData.endPage + 1) + '">Next</a></li>';
    }

    pageStr += '</ul>';
    pageStr += '</nav>';

    console.log(pageStr);

    target.empty();
    target.append(pageStr);
    };

     // 페이지 번호 클릭설정
     $("div#qnaPaging").on("click", "li a", function(e) {
      e.preventDefault(); // a태그의 링크기능을 제거.

      qnaPage = $(this).attr("href");  // 선택한 페이지 번호 값

      url = "/qna/qna_list/" + pro_code + "/" + qnaPage;

      getPage(url);
    });

    // QnA 모달
    $("#btnQnaModal").on("click", function() {
      $("#btnQnaSave").show();
      $("#btnQnaModify").hide();
      $("#btnQnaDelete").hide();
      $("#qna_answer_form").hide();
      $("#qnaModal").modal("show");
    });

    // QnA 모달 리셋
    $("#qnaModal").on("hidden.bs.modal", function() {
      $("#qna_title").val("");
      $("#qna_content").val("");
    });

    // QnA 저장
    $("#btnQnaSave").on("click", function(){ 
      let pro_code = $(this).data("pro_code");
      let qna_title = $("#qna_title").val();
      let qna_content = $("#qna_content").val();

      // console.log("pro_code", pro_code);

      if (qna_title == "") {
        alert("제목을 입력하세요.");
        $("#qna_title").focus();
        return;
      }

      if (qna_content == "") {
        alert("내용을 입력하세요.");
        $("#qna_content").focus();
        return;
      }
      

      let qna_data = {pro_code : pro_code, qna_title : qna_title, qna_content : qna_content};

      console.log("qna_data", qna_data); 
      $.ajax({
        url : '/qna/qna_write',
        type: 'post',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "POST"
        },
        data : JSON.stringify(qna_data), // object문법을 json문자열로 변환
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("QnA가 등록되었습니다.");
            $("#qnaModal").modal("hide");
            qnaPage = 1;
            getPage(qnaUrl);
          }
        }
      });    
    });

// 수정내용 가져오기
$(document).on("click", ".btn-qna-modify", function() {
    let qna_code = $(this).data("qna_code");

    console.log("수정 버튼 클릭됨! qna_code:", qna_code);

    $.ajax({
        url: '/qna/qna_info/' + qna_code, 
        type: 'get',
        dataType: 'json',
        success: function(result) {
            console.log("받아온 데이터:", result);

            // 모달 내부 입력 필드에 값 설정
            $("#qna_code").val(result.qna_code);
            $("#qna_title").val(result.qna_title);
            $("#qna_content").val(result.qna_content);

            // 수정 및 삭제 버튼 표시
            $("#btnQnaSave").hide();
            $("#btnQnaModify").show().data("qna_code", qna_code);
            $("#btnQnaDelete").show().data("qna_code", qna_code);

            // 모달 표시
            $("#qnaModal").modal("show").on('shown.bs.modal', function () {
                $("#qna_title").focus();
            });
        },
        error: function(xhr, status, error) {
            console.error("에러 발생:", error);
        }
    });
});


    $("#btnQnaModify").on("click", function() {
      let pro_code = $(this).data("pro_code");
      let qna_code = $(this).data("qna_code");
      let qna_title = $("#qna_title").val();
      let qna_content = $("#qna_content").val();

      if (qna_title.trim() == "") {
        alert("제목을 입력하세요.");
        $("#qna_title").focus();
        return;
      }

      if (qna_content.trim() == "") {
        alert("내용을 입력하세요.");
        $("#qna_content").focus();
        return;
      }

      let qna_data = {pro_code : pro_code, qna_code : qna_code, qna_title : qna_title, qna_content : qna_content};

      
      $.ajax({
        url: '/qna/qna_modify',
        type: 'put',
        headers: {
          "Content-Type" : "application/json", "X-HTTP-Method-Overrid" : "PUT"
        },
        data: JSON.stringify(qna_data),
        dataType: 'text',
        success: function(result) {
          if(result == "success") {
            alert("QnA가 수정되었습니다.");
            $("#btnQnaModify").modal("hide");
            getPage(qnaUrl);
          }
        }
    });
  });

  // QnA 삭제
  $(document).on("click", ".btn-qna-delete", function() {
    if (!confirm("QnA를 삭제하시겠습니까?")) return;

    let qna_code = $(this).data("qna_code");

    $.ajax({
        url: '/qna/qna_delete/' + qna_code,
        type: 'DELETE',
        headers: { "X-HTTP-Method-Overrid": "DELETE" },
        dataType: 'text',
        success: function(result) {
            if (result === "success") {
                alert("QnA가 삭제되었습니다.");
                getPage(qnaUrl);  // 리스트 갱신
            }
        }
    });
});

    }); // ready 끝

  </script>
</th:block>
</html>